package utils

import (
	"bytes"
	"fmt"
	"io"
	"io/ioutil"
	"net/http"
	"time"
)

func PrintLnResp(resp *http.Response) {
	body, _ := ioutil.ReadAll(resp.Body)
	fmt.Println(string(body))
}

//使用POST的方法发送数据
//传入字符串数据
func PostData(url string, data string, header map[string]string) *http.Response {
	postbody := bytes.NewBufferString(data)
	req, err := http.NewRequest("POST", url, postbody)
	if err != nil {
		recover()
	} else {
		req.Close = true
	}

	//添加请求头，使用Set方法：如果原来没有该请求头，则添加，如果有，则修改
	if header != nil {
		for k, v := range header {
			req.Header.Set(k, v)
		}
	}
	client := http.Client{Timeout: 10 * time.Second}

	resp, err := client.Do(req)
	if err != nil {
		recover()
	}
	return resp
}

//使用POST的方法发送数据
//传入io.Reader类型的数据
func PostData2(url string, data io.Reader, header map[string]string) *http.Response {
	req, err := http.NewRequest("POST", url, data)
	if err != nil {
		recover()
	} else {
		req.Close = true
	}

	//添加请求头，使用Set方法：如果原来没有该请求头，则添加，如果有，则修改
	if header != nil {
		for k, v := range header {
			req.Header.Set(k, v)
		}
	}
	client := http.Client{Timeout: 10 * time.Second}

	resp, err := client.Do(req)
	return resp
}
